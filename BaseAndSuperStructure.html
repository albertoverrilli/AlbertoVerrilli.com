<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base and Super Structure - Alberto Verrilli</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: monospace;
            background-color: #ffffff;
            color: #000000;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .back-button {
            position: fixed;
            top: 1rem;
            left: 1rem;
            padding: 0.5rem 1rem;
            background-color: #000;
            color: #fff;
            text-decoration: none;
            font-weight: bold;
            text-transform: uppercase;
            border: 2px solid #000;
            transition: all 0.2s;
            z-index: 100;
        }

        .back-button:hover {
            background-color: #fff;
            color: #000;
        }

        .map-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            padding: 2rem;
            box-sizing: border-box;
            max-width: 1200px;
            /* Limit width for better readability on large screens */
        }

        .map-header {
            max-width: 56rem;
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid #000;
            padding-bottom: 1rem;
            width: 100%;
        }

        .map-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.05em;
            margin-bottom: 0.5rem;
            margin-top: 0;
            text-transform: uppercase;
        }

        .map-header p {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #4b5563;
            margin: 0;
        }

        .content-wrapper {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            align-items: flex-start;
            justify-content: center;
            width: 100%;
        }

        @media (min-width: 1024px) {
            .content-wrapper {
                flex-direction: row;
            }
        }

        .svg-container {
            position: relative;
            border: 2px solid #000;
            padding: 1rem;
            background-color: #fff;
            flex: 1;
            display: flex;
            justify-content: center;
        }

        .tooltip {
            position: absolute;
            top: 1rem;
            left: 1rem;
            z-index: 10;
            pointer-events: none;
            background-color: #fff;
            border: 1px solid #000;
            padding: 0.5rem;
            font-size: 0.75rem;
            text-transform: uppercase;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .tooltip.visible {
            opacity: 1;
        }

        .info-panel {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        @media (min-width: 1024px) {
            .info-panel {
                width: 24rem;
                /* Fixed width for sidebar on desktop */
                flex-shrink: 0;
            }
        }

        .info-box {
            border: 2px solid #000;
            padding: 1.5rem;
            background-color: #fff;
        }

        .info-box h2 {
            font-size: 1.125rem;
            font-weight: 700;
            text-transform: uppercase;
            margin-top: 0;
            margin-bottom: 1rem;
            border-bottom: 1px solid #000;
            padding-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .layer-details {
            opacity: 0;
            transition: opacity 0.3s;
            display: none;
        }

        .layer-details.active {
            opacity: 1;
            display: block;
        }

        .layer-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-top: 0;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: -0.025em;
        }

        .layer-desc {
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
            line-height: 1.625;
        }

        .index-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
            font-size: 0.75rem;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .index-item {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.25rem;
        }

        .dynamics-list {
            font-size: 0.75rem;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .dynamics-item {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        /* SVG Styles */
        svg {
            cursor: crosshair;
            max-width: 100%;
            height: auto;
        }

        .hover-stroke {
            transition: stroke-width 0.2s;
        }

        .hover-stroke:hover {
            stroke-width: 3px;
        }

        .cursor-pointer {
            cursor: pointer;
        }

        .opacity-50 {
            opacity: 0.5;
        }

        .opacity-100 {
            opacity: 1;
        }

        .group:hover .group-hover-opacity-100 {
            opacity: 1;
        }

        .group:hover .group-hover-stroke-blue {
            stroke: #2563eb;
        }

        .group:hover .group-hover-stroke-red {
            stroke: #dc2626;
        }

        .transition-all {
            transition: all 0.2s;
        }

        .text-red {
            color: #dc2626;
            font-weight: bold;
        }

        .text-blue {
            color: #2563eb;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <a href="Diagrams.html" class="back-button">‚Üê Back</a>

    <div class="map-container">

        <!-- HEADER -->
        <div class="map-header">
            <h1>TOPOLOGY OF THE SOCIAL FORMATION</h1>
            <p>Structure / Determination / Reproduction</p>
        </div>

        <div class="content-wrapper">

            <!-- LEFT: THE MAP -->
            <div class="svg-container">

                <!-- Tooltip -->
                <div id="tooltip" class="tooltip">
                    <!-- Content injected by JS -->
                </div>

                <svg id="marxist-map" viewBox="0 0 800 800">
                    <defs>
                        <marker id="arrowhead-solid" markerWidth="8" markerHeight="8" refX="8" refY="4" orient="auto">
                            <path d="M0,0 L8,4 L0,8 Z" fill="black" />
                        </marker>
                        <marker id="arrowhead-open" markerWidth="8" markerHeight="8" refX="8" refY="4" orient="auto">
                            <path d="M0,0 L8,4 L0,8" fill="none" stroke="black" strokeWidth="1" />
                        </marker>
                    </defs>
                    <!-- Content injected by JS -->
                </svg>
            </div>

            <!-- RIGHT: INFO PANEL -->
            <div class="info-panel">

                <div class="info-box" style="min-height: 300px;">
                    <h2><i data-lucide="database"></i> Structural Analysis</h2>

                    <div id="layer-content">
                        <div id="empty-state"
                            style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 12rem; color: #9ca3af;">
                            <p style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em;">[ AWAITING
                                INPUT ]</p>
                            <p style="font-size: 0.625rem;">Select a level to inspect.</p>
                        </div>
                        <div id="active-content" class="layer-details">
                            <h3 id="detail-label" class="layer-title"></h3>
                            <p id="detail-desc" class="layer-desc"></p>

                            <div>
                                <h4
                                    style="font-weight: 700; font-size: 0.75rem; text-transform: uppercase; border-bottom: 1px solid #000; display: inline-block; margin-bottom: 0.5rem;">
                                    Index of Elements:</h4>
                                <ul id="detail-list" class="index-list"></ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <h2><i data-lucide="activity"></i> Structural Dynamics</h2>
                    <ul class="dynamics-list">
                        <li class="dynamics-item">
                            <span class="text-red" style="font-size: 1.2em;">&#8635;</span>
                            <div>
                                <strong>Reproduction (Loops):</strong>
                                <span style="color: #4b5563;">The Superstructure maintains and reproduces the relations
                                    of production. Ideology ensures submission to the established order.</span>
                            </div>
                        </li>
                        <li class="dynamics-item">
                            <span style="font-size: 1.2em;">&#8593;</span>
                            <div>
                                <strong>Determination (Dashed Lines):</strong>
                                <span style="color: #4b5563;">The Economic Base determines the Superstructure "in the
                                    last instance".</span>
                            </div>
                        </li>
                        <li class="dynamics-item">
                            <span class="text-blue" style="font-size: 1.2em;">&#8634;</span>
                            <div>
                                <strong>Relative Autonomy (Arcs):</strong>
                                <span style="color: #4b5563;">The Superstructure has its own specific effectivity and is
                                    not a simple reflection of the Base. It can react back upon the Base.</span>
                            </div>
                        </li>
                    </ul>
                </div>

                <script>
                    // Initialize Lucide icons
                    lucide.createIcons();

                    // --- CONFIGURATION ---
                    const width = 800;
                    const height = 800;
                    const centerX = width / 2;
                    const centerY = height / 2;

                    const radii = {
                        center: 110, // MoP (Bedrock)
                        econ: 190,   // Economic Interface
                        pol: 270,    // Political Ring
                        ideo: 350    // Ideological Ring
                    };

                    // --- DATA STRUCTURE ---
                    const layers = {
                        center: {
                            id: 'center',
                            label: "MODE OF PRODUCTION",
                            subLabel: "Infrastructure",
                            color: "#111827",
                            textColor: "#ffffff",
                            desc: "THE INFRASTRUCTURE. UNITY OF FORCES & RELATIONS. DETERMINANT IN THE LAST INSTANCE.",
                            nodes: [
                                { id: 'forces', label: 'FORCES', angle: 330, detail: "Labour Power, Tools, Raw Materials" },
                                { id: 'relations', label: 'RELATIONS', angle: 150, detail: "Ownership, Exploitation, Class Division" }
                            ]
                        },
                        econ: {
                            id: 'econ',
                            label: "ECONOMIC LEVEL",
                            color: "#f3f4f6",
                            textColor: "#000000",
                            desc: "THE SPHERE OF CIRCULATION & EXCHANGE.",
                            nodes: [
                                { id: 'dist', label: 'DISTRIBUTION', angle: 45 },
                                { id: 'exch', label: 'EXCHANGE', angle: 135 },
                                { id: 'cons', label: 'CONSUMPTION', angle: 225 },
                                { id: 'circ', label: 'CIRCULATION', angle: 315 }
                            ]
                        },
                        pol: {
                            id: 'pol',
                            label: "POLITICO-LEGAL (RSA)",
                            color: "#e5e7eb",
                            textColor: "#000000",
                            desc: "REPRESSIVE STATE APPARATUS. MONOPOLY OF VIOLENCE.",
                            nodes: [
                                { id: 'state', label: 'STATE', angle: 0 },
                                { id: 'gov', label: 'GOV', angle: 45 },
                                { id: 'admin', label: 'ADMIN', angle: 90 },
                                { id: 'army', label: 'ARMY', angle: 135 },
                                { id: 'police', label: 'POLICE', angle: 180 },
                                { id: 'courts', label: 'COURTS', angle: 225 },
                                { id: 'prisons', label: 'PRISONS', angle: 270 },
                                { id: 'law', label: 'LAW', angle: 315 }
                            ]
                        },
                        ideo: {
                            id: 'ideo',
                            label: "IDEOLOGICAL (ISA)",
                            color: "#d1d5db",
                            textColor: "#000000",
                            desc: "IDEOLOGICAL STATE APPARATUSES. INTERPELLATION OF SUBJECTS.",
                            nodes: [
                                { id: 'edu', label: 'SCHOOL', angle: 0 },
                                { id: 'fam', label: 'FAMILY', angle: 45 },
                                { id: 'rel', label: 'CHURCH', angle: 90 },
                                { id: 'med', label: 'MEDIA', angle: 135 },
                                { id: 'cul', label: 'CULTURE', angle: 180 },
                                { id: 'pol_isa', label: 'PARTIES', angle: 225 },
                                { id: 'uni', label: 'UNIONS', angle: 270 },
                                { id: 'leg_isa', label: 'LEGAL', angle: 315 }
                            ]
                        }
                    };

                    // --- HELPER FUNCTIONS ---
                    const getPos = (r, angleDeg) => {
                        const angleRad = (angleDeg - 90) * (Math.PI / 180);
                        return {
                            x: centerX + r * Math.cos(angleRad),
                            y: centerY + r * Math.sin(angleRad)
                        };
                    };

                    const svg = document.getElementById('marxist-map');
                    const tooltip = document.getElementById('tooltip');
                    const emptyState = document.getElementById('empty-state');
                    const activeContent = document.getElementById('active-content');
                    const detailLabel = document.getElementById('detail-label');
                    const detailDesc = document.getElementById('detail-desc');
                    const detailList = document.getElementById('detail-list');

                    let activeLayerId = null;

                    function setActiveLayer(id) {
                        activeLayerId = id;

                        if (id) {
                            const layer = layers[id];
                            emptyState.style.display = 'none';
                            activeContent.classList.add('active');

                            detailLabel.textContent = layer.label;
                            detailDesc.textContent = layer.desc;

                            detailList.innerHTML = layer.nodes.map(n => `
                    <li class="index-item">
                        <span style="font-weight: 700;">${n.label}</span>
                        ${n.detail ? `<span style="color: #6b7280; font-size: 10px; text-transform: uppercase;">${n.detail}</span>` : ''}
                    </li>
                `).join('');
                        } else {
                            emptyState.style.display = 'flex';
                            activeContent.classList.remove('active');
                        }
                    }

                    function showTooltip(text, type) {
                        tooltip.innerHTML = text;
                        tooltip.classList.add('visible');
                    }

                    function hideTooltip() {
                        tooltip.classList.remove('visible');
                    }

                    // --- RENDER FUNCTIONS ---

                    function createSVGElement(tag, attrs) {
                        const el = document.createElementNS("http://www.w3.org/2000/svg", tag);
                        for (const [key, value] of Object.entries(attrs)) {
                            el.setAttribute(key, value);
                        }
                        return el;
                    }

                    function renderMap() {
                        // 1. Rings and Nodes
                        ['ideo', 'pol', 'econ'].forEach(layerKey => {
                            const layer = layers[layerKey];
                            const r = radii[layerKey];

                            const group = createSVGElement('g', { class: 'cursor-pointer' });
                            group.onclick = () => setActiveLayer(layerKey);

                            // Circle
                            const circle = createSVGElement('circle', {
                                cx: centerX, cy: centerY, r: r,
                                fill: 'none', stroke: 'black', 'stroke-width': '1.5',
                                class: 'hover-stroke transition-all'
                            });
                            group.appendChild(circle);

                            // Nodes
                            layer.nodes.forEach(node => {
                                const pos = getPos(r - (layerKey === 'econ' ? 35 : 40), node.angle);
                                const nodeGroup = createSVGElement('g', {});

                                // Shape
                                let shape;
                                const size = layerKey === 'econ' ? 4 : 6;
                                if (layerKey === 'pol') {
                                    shape = createSVGElement('rect', {
                                        x: pos.x - size, y: pos.y - size, width: size * 2, height: size * 2,
                                        fill: 'white', stroke: 'black', 'stroke-width': '2'
                                    });
                                } else if (layerKey === 'ideo') {
                                    shape = createSVGElement('circle', {
                                        cx: pos.x, cy: pos.y, r: size,
                                        fill: 'white', stroke: 'black', 'stroke-width': '2'
                                    });
                                } else { // econ
                                    shape = createSVGElement('path', {
                                        d: `M ${pos.x} ${pos.y - size} L ${pos.x + size} ${pos.y} L ${pos.x} ${pos.y + size} L ${pos.x - size} ${pos.y} Z`,
                                        fill: 'black'
                                    });
                                }
                                nodeGroup.appendChild(shape);

                                // Text
                                const text = createSVGElement('text', {
                                    x: pos.x, y: pos.y + (layerKey === 'econ' ? 15 : 20),
                                    'text-anchor': 'middle', 'font-size': layerKey === 'econ' ? '9' : '10',
                                    fill: 'black', class: 'uppercase tracking-widest'
                                });
                                text.textContent = node.label;
                                nodeGroup.appendChild(text);

                                group.appendChild(nodeGroup);
                            });

                            // Label
                            const label = createSVGElement('text', {
                                x: centerX, y: centerY - r + 35,
                                'text-anchor': 'middle', 'font-size': '12',
                                fill: 'black', class: 'uppercase tracking-[0.2em]',
                                style: 'fill: black; stroke: white; stroke-width: 4px; paint-order: stroke;' // Outline effect for readability
                            });
                            const labelText = createSVGElement('tspan', { style: 'stroke: none;' }); // Actual text
                            labelText.textContent = layerKey === 'ideo' ? "LEVEL III: IDEOLOGICAL" : (layerKey === 'pol' ? "LEVEL II: POLITICAL" : "LEVEL I: ECONOMIC");
                            label.appendChild(labelText);
                            group.appendChild(label);

                            svg.appendChild(group);
                        });

                        // 2. Arrows (Determination)
                        const detGroup = createSVGElement('g', { class: 'opacity-100 pointer-events-none' });
                        [0, 45, 90, 135, 180, 225, 270, 315].forEach(angle => {
                            const start = getPos(radii.center + 5, angle);
                            const end = getPos(radii.ideo + 30, angle);
                            const line = createSVGElement('line', {
                                x1: start.x, y1: start.y, x2: end.x, y2: end.y,
                                stroke: 'black', 'stroke-width': '1', 'stroke-dasharray': '2,4'
                            });
                            detGroup.appendChild(line);
                        });
                        svg.appendChild(detGroup);

                        // 3. Reproduction Arrows
                        const repGroup = createSVGElement('g', {});
                        const repPaths = [
                            { startRing: 'ideo', angle: 25 },
                            { startRing: 'pol', angle: 145 },
                            { startRing: 'econ', angle: 265 }
                        ];
                        repPaths.forEach(p => {
                            const start = getPos(radii[p.startRing], p.angle);
                            const end = getPos(radii.center, p.angle - 20);
                            const cp = getPos(radii[p.startRing] + 80, p.angle + 20);

                            const pathGroup = createSVGElement('g', { class: 'cursor-pointer group' });
                            pathGroup.onmouseenter = () => showTooltip('<span class="text-red">[ REPRODUCTION LOOP ]</span>');
                            pathGroup.onmouseleave = hideTooltip;

                            const path = createSVGElement('path', {
                                d: `M ${start.x} ${start.y} Q ${cp.x} ${cp.y} ${end.x} ${end.y}`,
                                fill: 'none', stroke: 'black', 'stroke-width': '2',
                                'marker-end': 'url(#arrowhead-solid)',
                                class: 'opacity-100 transition-all group-hover-stroke-red'
                            });
                            pathGroup.appendChild(path);
                            repGroup.appendChild(pathGroup);
                        });
                        svg.appendChild(repGroup);

                        // 4. Autonomy Arrows
                        const autoGroup = createSVGElement('g', { class: 'cursor-pointer group' });
                        autoGroup.onmouseenter = () => showTooltip('<span class="text-blue">[ RELATIVE AUTONOMY ]</span>');
                        autoGroup.onmouseleave = hideTooltip;

                        [radii.econ, radii.pol, radii.ideo].forEach(r => {
                            [0, 120, 240].forEach(deg => {
                                const startAngle = deg * (Math.PI / 180);
                                const endAngle = (deg + 60) * (Math.PI / 180);
                                const start = { x: centerX + r * Math.cos(startAngle), y: centerY + r * Math.sin(startAngle) };
                                const end = { x: centerX + r * Math.cos(endAngle), y: centerY + r * Math.sin(endAngle) };

                                const path = createSVGElement('path', {
                                    d: `M ${start.x} ${start.y} A ${r} ${r} 0 0 1 ${end.x} ${end.y}`,
                                    fill: 'none', stroke: 'black', 'stroke-width': '1.5',
                                    'stroke-dasharray': '4,2', 'marker-end': 'url(#arrowhead-open)',
                                    class: 'opacity-50 transition-all group-hover-opacity-100 group-hover-stroke-blue'
                                });
                                autoGroup.appendChild(path);
                            });
                        });
                        svg.appendChild(autoGroup);

                        // 5. Center (MoP)
                        const centerGroup = createSVGElement('g', { class: 'cursor-pointer' });
                        centerGroup.onclick = () => setActiveLayer('center');

                        const centerCircle = createSVGElement('circle', { cx: centerX, cy: centerY, r: radii.center, fill: 'black' });
                        centerGroup.appendChild(centerCircle);

                        const centerDash = createSVGElement('circle', {
                            cx: centerX, cy: centerY, r: radii.center + 5,
                            fill: 'none', stroke: 'black', 'stroke-width': '1', 'stroke-dasharray': '4,2'
                        });
                        centerGroup.appendChild(centerDash);

                        layers.center.nodes.forEach(node => {
                            const pos = getPos(radii.center - 40, node.angle);
                            const nodeGroup = createSVGElement('g', {});
                            const poly = createSVGElement('polygon', {
                                points: `${pos.x},${pos.y - 8} ${pos.x + 8},${pos.y + 8} ${pos.x - 8},${pos.y + 8}`,
                                fill: 'white'
                            });
                            nodeGroup.appendChild(poly);
                            const text = createSVGElement('text', {
                                x: pos.x, y: pos.y + 24, 'text-anchor': 'middle', 'font-size': '10',
                                fill: 'white', class: 'uppercase tracking-wider'
                            });
                            text.textContent = node.label;
                            nodeGroup.appendChild(text);
                            centerGroup.appendChild(nodeGroup);
                        });

                        const centerLabel = createSVGElement('text', {
                            x: centerX, y: centerY, 'text-anchor': 'middle', 'font-size': '14',
                            fill: 'white', class: 'uppercase tracking-widest', 'dominant-baseline': 'middle',
                            'font-weight': 'bold'
                        });
                        centerLabel.textContent = "MODE OF PRODUCTION [BASE]";
                        centerGroup.appendChild(centerLabel);

                        svg.appendChild(centerGroup);
                    }

                    // Initialize
                    renderMap();

                </script>
            </div>
        </div>
    </div>
</body>

</html>